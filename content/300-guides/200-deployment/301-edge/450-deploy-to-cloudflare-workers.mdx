---
title: 'Deploy to Cloudflare Workers'
metaTitle: 'Deploy to Cloudflare Workers'
metaDescription: 'Learn how to deploy a TypeScript application to Cloudflare Workers that connects to PostgreSQL.'
---

<TopBlock>

Today you'll be deploying a Cloudflare Worker that uses Prisma to save every request to a PostgreSQL database and fetches the 20 of the most recent logs.

This guide covers Prisma, TypeScript, PostgreSQL, Prisma Accelerate, and Cloudflare Workers. Let's get started!

<Admonition type="warning">

**Note**<br /><br />
We are continuously testing Prisma Accelerate with Cloudflare Workers. [Open an issue](https://github.com/prisma/prisma/issues/new/choose) if you run into problems or have questions about deploying to Cloudflare Workers.

</Admonition>

</TopBlock>

## Prerequisites

- A PostgreSQL database that is publicly accessible
- [Cloudflare Workers](https://workers.cloudflare.com/) account
- [Prisma Data Platform](https://console.prisma.io/) account
- Node.js & npm installed
- Git installed

Open your terminal and navigate to a location of your choice. Run the following commands to set up your application.

```terminal
mkdir prisma-cloudflare-accelerate
cd prisma-cloudflare-accelerate
npm init -y
npm install -D prisma typescript wrangler
```

## 1. Set up Wrangler

Wrangler is the official Cloudflare Worker CLI. You will use it to develop and deploy to Cloudflare Workers. This guide uses [Wrangler v3](https://developers.cloudflare.com/workers/wrangler/).

First, initialize Wrangler. To do this, run the following command in your terminal:

```terminal
npx wrangler init
```

This will ask you a few questions.

```terminal
Would you like to use git to manage this Worker? (y/n)
```

We want to use Git, so answer yes.

```terminal
Would you like to use TypeScript? (y/n)
```

We also want to use TypeScript, so answer yes.

```terminal
Would you like to create a Worker at src/index.ts?
```

Select the `Fetch Handler` option.

Once you're done, this will create a `wrangler.toml` file with some initial configuration.

Next, authenticate the Wrangler CLI with your Cloudflare Workers account. To do this, run the following command in your terminal:

```terminal
npx wrangler login
```

You can now verify that you're logged in by running `npx wrangler whoami`.

```terminal
npx wrangler whoami
```

## 2. Set up Prisma

Now you're ready to add Prisma to the project.

```terminal
npx prisma init
```

This creates a Prisma schema in `prisma/schema.prisma`.

<Admonition>

**Note:**<br /><br />

This process also creates an `.env` file, but this file has no effect when you use Cloudflare Workers.

</Admonition>

Inside `prisma/schema.prisma`, add the following schema:

```prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Log {
  id      Int    @id @default(autoincrement())
  level   Level
  message String
  meta    Json
}

enum Level {
  Info
  Warn
  Error
}
```

This data model will be used to fetch logs from your Worker.

## 3. Create a repository and push to GitHub

To prepare for the steps ahead, let's [create a private repository](https://github.com/new) on GitHub.
Next, initialize your repository, then push your changes up to GitHub.

```terminal
git remote add origin https://github.com/<username>/prisma-cloudflare-accelerate
git add .
git commit -m "initial commit"
git push -u origin main
```

You're ready to import your project into the Prisma Data Platform.

## 4. Enable Accelerate in Prisma Data Platform

With Cloudflare Workers, you can't directly access your database because there is no TCP support. Fortunately, Prisma has your back with [Prisma Accelerate](/data-platform/accelerate).

To get started, sign up for a free [Prisma Data Platform account](https://console.prisma.io/), enable Accelerate and generate an Accelerate connection string.

## 5. Set the Accelerate connection string in your environment

1. Add the Prisma Accelerate connection string to your local environment `.env` file.

   ```diff file=.env
   +DATABASE_URL="prisma://accelerate.prisma-data.net/?api_key=__API_KEY__"
   -DATABASE_URL="postgres://..."
   ```

2. In your code editor, add the connection string in the `wrangler.toml` file.

   ```diff file=wrangler.toml
     name = "prisma-cloudflare-accelerate"
     main = "src/main.ts"
     compatibility_date = "2022-11-07"

   + [vars]
   + DATABASE_URL = "prisma://accelerate.prisma-data.net/?api_key=__API_KEY__"
   ```

3. Install the Accelerate Client extension

   ```bash
   npm install @prisma/extension-accelerate
   ```

You are now ready to generate a Prisma Client.

## 6. Generate a Prisma Client

Next, you'll generate Prisma Client that connects to your database through [Prisma Accelerate](/data-platform/accelerate) over HTTP.

```terminal
npx prisma generate --no-engine
```

<Admonition>

Prior to Prisma 5.2.0, the `--no-engine` flag is not available. Instead, use the `--accelerate` flag.

```terminal
npx prisma generate --accelerate
```

</Admonition>

The generated Client has a smaller bundle size and is optimized for edge environments like Cloudflare Workers.

The smaller bundle size is due to the fact that the interfaces talking to the database (the [Prisma engines](/concepts/components/prisma-engines)) are no longer bundled with Prisma Client as this logic is now handled by Prisma Accelerate.

## 7. Develop the Cloudflare Worker function

You're now ready to create a Cloudflare Worker. Create a `src/index.ts` file with the following code:

```ts
import { PrismaClient } from '@prisma/client/edge'
import { withAccelerate } from '@prisma/extension-accelerate'

export interface Env {
  DATABASE_URL: string
}

export default {
  async fetch(
    request: Request,
    env: Env,
    ctx: ExecutionContext
  ): Promise<Response> {
    const prisma = new PrismaClient({
      datasourceUrl: env.DATABASE_URL,
    }).$extends(withAccelerate())

    await prisma.log.create({
      data: {
        level: 'Info',
        message: `${request.method} ${request.url}`,
        meta: {
          headers: JSON.stringify(request.headers),
        },
      },
    })

    const { data, info } = await prisma.logs
      .findMany({
        take: 20,
        orderBy: {
          id: 'desc',
        },
      })
      .withAccelerateInfo()

    return new Response(`request method: ${request.method}!`)
  },
}
```

> The [`info`](data-platform/accelerate/api-reference#return-type) object has additional information which can be useful for debugging.
> Accelerate can also be used to cache your query results. You can find more information on caching with Prisma Accelerate in [here](data-platform/accelerate).

Run `npx wrangler dev` to see your worker in development:

```
ðŸ‘‚  Listening on http://127.0.0.1:8787
```

Go ahead and open `http://127.0.0.1:8787`. If all goes well, you should see:

```
request method: GET!
```

Refresh the page a couple times to verify that it's working.

## 8. Publish to Cloudflare Workers

You're now ready to deploy to Cloudflare Workers. Run the following command:

```terminal
npx wrangler publish
```

This will pack your application with webpack and upload to Cloudflare. With a bit of luck, you'll see the following:

```
âœ¨  Built successfully, built project size is 94 KiB.
âœ¨  Successfully published your script to
https://prisma-cloudflare-accelerate.ankman.workers.dev
```

Visit your deployment URL and you'll again see:

```
request method: GET!
```

You're all set! You've successfully deployed a Cloudflare Worker written in TypeScript that uses Prisma to talk to your PostgreSQL database.

Give yourself a pat on the back, you deserve it!
